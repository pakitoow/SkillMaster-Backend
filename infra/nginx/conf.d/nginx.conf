server {
    listen 80;
    server_name tyre-services.com.fr.local www.tyre-services.com.fr.local \
                tyre-services.com.en.local www.tyre-services.com.en.local \
                www.tyre-services.com.es.local;

    server_tokens off;
    client_max_body_size 50M;

    # Gzip compression
    gzip on;
    gzip_comp_level 6;
    gzip_http_version 1.0;
    gzip_proxied any;
    gzip_disable "msie6";
    gzip_types
        text/css
        text/x-component
        application/javascript
        text/javascript
        text/x-js
        text/richtext
        image/svg+xml
        text/plain
        text/xsd
        text/xsl
        text/xml
        image/bmp
        application/java
        application/msword
        application/vnd.ms-fontobject
        application/x-msdownload
        image/x-icon
        image/webp
        application/json
        application/pdf
        application/vnd.ms-powerpoint
        application/x-font-ttf
        audio/wav
        application/font-woff
        application/font-woff2
        application/vnd.ms-excel;

    root /var/www/html/public;
    index index.php index.html;

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # Deny hidden files like .env, .git, etc.
    location ~ /\. {
        deny all;
    }

    # Deny sensitive files/folders
    location ~* /(Gruntfile\.js|package\.json|node_modules) {
        deny all;
        return 404;
    }

    # Symfony front controller
    location / {
        try_files $uri /index.php$is_args$args;
    }

    # PHP handling via FastCGI
    location ~ \.php$ {
        include fastcgi_params;
        fastcgi_pass php:9000;           # PHP-FPM container
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;

        fastcgi_buffer_size 32k;
        fastcgi_buffers 4 32k;
        fastcgi_read_timeout 300s;
        fastcgi_send_timeout 300s;
    }

    # Optional: static assets caching
    location ~* \.(?:ico|css|js|gif|jpe?g|png|woff2?|eot|ttf|svg|webp)$ {
        expires 1M;
        access_log off;
        add_header Cache-Control "public";
    }
}

